{%- macro errorspan(v) -%}
  {%- if v -%}
    <span class="error">{{v}}</span>
  {%- endif -%}
{%- endmacro -%}

{% macro field(field) %}
<div class="form_field">
{% if field.errors %}
  {% set css_class = 'has_error ' + kwargs.pop('class', '') %}
  {{ field(class=css_class, **kwargs) }}
  <ul class="errors">{% for error in errors %}<li>{{ error|e }}</li>{% endfor %}</ul>
{% else %}
  {{ field(**kwargs) }}
{% endif %}
</div>
{% endmacro %}